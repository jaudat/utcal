<p id="notice"><%= notice %></p>

<% @courses.each do |course| %>
<%= course.to_json %>
<%end%>

<script type="text/javascript">
function maxDays(year, month){
	return new Date(year, month, 0).getDate();
}

function convertDateToJS(input){
	var dateValues = input.split("-");
	return new Date(Number(dateValues[0]), Number(dateValues[1])-1, Number(dateValues[2]));
}



$(document).ready(function(){
	var dateSet = new Array();

	<% @courses.each do |course| %>
	<% course.start = course.start.to_time.to_i %>
	<% course.end = Time.at(course.end.to_i).to_formatted_s(:db).to_i %>
	<%end%>

	var coursesToJSON = <%= raw @courses.to_json %> 
	var i = 0;
	
	for ( i = 0; i < coursesToJSON.length; i++){	
		var dateObject = new Array();

		dateObject["start"]= new Date(coursesToJSON[i].start*1000);
		dateObject["end"] = new Date(coursesToJSON[i].end*1000);
		alert("class starts at"+dateObject["start"].getHours() +" and ends at " + dateObject["end"].getHours());
		//dateObject["start"] = coursesToJSON[i];
		//dateObject["end"] = coursesToJSON[i];
		dateObject["title"] = coursesToJSON[i].title;
		dateObject["start"].setDate(dateObject["start"].getDate());

		alert("first date: "+ dateObject["start"]);
		if(dateObject["start"].getMonth() == 0){
			var endBefore = new Date(dateObject["start"].getFullYear(), 3, 8);
		}else if(dateObject["start"].getMonth() == 3){
			var endBefore = new Date(dateObject["start"].getFullYear(), 7, 8);
		}else{
			var endBefore = new Date(dateObject["start"].getFullYear(), 11, 6);
		}

		while(dateObject["start"].getTime() < endBefore.getTime()){
			alert("Adding :" + dateObject["start"]);
			var polishToAdd = new Array();
			polishToAdd["start"] = dateObject['start'].getTime()/1000;
			polishToAdd["end"] = dateObject["end"].getTime()/1000;
			polishToAdd["start"] += 18000;
			polishToAdd["end"] += 18000;
			polishToAdd["title"] = dateObject["title"];
			polishToAdd["allDay"] = false;
			dateSet.push(polishToAdd);
				
			dateObject["start"].setMinutes(dateObject["start"].getMinutes() + 60*24*7);
			dateObject["end"].setMinutes(dateObject["start"].getMinutes());
		}
		
	}
 


        $("#calendar").fullCalendar({
                header: {
                        left: 'prev, next today',
                        middle: 'title',
                        right: 'agendaWeek'
                },
		events: dateSet,
                defaultView: 'agendaWeek',
                editable: false,
                slotMinutes: 60,
                minTime: 9,
                maxTime: 23
        })
});

</script>

<div id='calendar'></div>

<p class="test">
  <b>First name:</b>
  <%= @professor.f_name %>
</p>

<p>
  <b>Last name:</b>
  <%= @professor.l_name %>
</p>

<%= link_to 'Edit', edit_professor_path(@professor) %> |
<%= link_to 'Back', professors_path %>

<% @courses.each do |course| %>
<%= course.to_json %>
<% end %>
